<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SQDC - Portail des Produits</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <header>
        <div class="header-content">
            <div class="logo-section">
                <div class="sqdc-logo">SQDC</div>
                <h1>Portail des Produits</h1>
            </div>
            <div class="store-info">
                <a href="print-lists.html" class="print-lists-link" title="G√©rer les listes d'impression">
                    üñ®Ô∏è Listes d'impression
                </a>
                <button class="section-config-btn" id="sectionConfigBtn" title="Configurer les sections">
                    <span class="config-icon">‚öôÔ∏è</span> Configurer les sections
                </button>
                <button class="store-id-btn" id="storeIdBtn" title="Modifier le num√©ro de succursale">
                    <span class="store-label">Succursale: <span id="storeIdDisplay">77074</span></span>
                    <span class="edit-icon">‚úèÔ∏è</span>
                </button>
            </div>
        </div>
    </header>

    <div class="controls">
        <div class="filter-section">
            <h3>Type de Cannabis</h3>
            <div class="filter-buttons" role="group" aria-label="Filtres de type de cannabis">
                <button class="filter-btn active" data-type="all" aria-pressed="true" aria-label="Afficher tous les types">
                    <span>Tous</span>
                </button>
                <button class="filter-btn active" data-type="Indica" aria-pressed="true" aria-label="Filtrer par type Indica">
                    <span class="icon indica-icon">‚óè</span>
                    <span>Indica</span>
                </button>
                <button class="filter-btn active" data-type="Sativa" aria-pressed="true" aria-label="Filtrer par type Sativa">
                    <span class="icon sativa-icon">‚óè</span>
                    <span>Sativa</span>
                </button>
                <button class="filter-btn active" data-type="Hybride" aria-pressed="true" aria-label="Filtrer par type Hybride">
                    <span class="icon hybride-icon">‚óè</span>
                    <span>Hybride</span>
                </button>
            </div>
        </div>

        <div class="search-section">
            <input type="text" id="searchInput" placeholder="Rechercher par nom ou marque..." aria-label="Rechercher des produits par nom ou marque">
        </div>
        
        <button class="add-product-btn" id="addProductBtn" title="Ajouter un nouveau produit">
            <span class="add-icon">‚ûï</span> Ajouter un produit
        </button>
    </div>

    <div class="wall-navigation" id="wallNavigation">
        <button class="wall-nav-btn active" data-wall="front">
            üè† Mur avant
        </button>
        <button class="wall-nav-btn" data-wall="side">
            üî≤ Mur lat√©ral
        </button>
        <div class="wall-stats" id="wallStats">
            <div class="wall-stats-row">
                <span class="stat-item">
                    <span class="stat-icon"></span>
                    <span class="stat-label">Plac√©s:</span>
                    <span class="stat-value" id="statPlacedProducts">0</span>
                </span>
                <span class="stat-item">
                    <span class="stat-icon">‚ö†Ô∏è</span>
                    <span class="stat-label">Non plac√©s:</span>
                    <span class="stat-value" id="statUnplacedProducts">0</span>
                </span>
            </div>
            <div class="wall-stats-row">
                <span class="stat-item">
                    <span class="stat-icon">üö™</span>
                    <span class="stat-label">Portes:</span>
                    <span class="stat-value" id="statDoorsCount">0</span>
                </span>
                <span class="stat-item">
                    <span class="stat-icon">üóÑÔ∏è</span>
                    <span class="stat-label">Tiroirs:</span>
                    <span class="stat-value" id="statDrawersCount">0</span>
                </span>
                <span class="stat-item">
                    <span class="stat-icon">‚¨ú</span>
                    <span class="stat-label">Emplacements vides:</span>
                    <span class="stat-value" id="statEmptySlots">0</span>
                </span>
            </div>
        </div>
    </div>

        <main>
        <!-- Dynamic sections will be generated here by regenerateSectionsHTML() -->
    </main>

    <!-- Tooltip for product details -->
    <div class="product-tooltip" id="productTooltip">
        <div class="tooltip-name" id="tooltipName"></div>
        <div class="tooltip-brand" id="tooltipBrand"></div>
        <div class="tooltip-format" id="tooltipFormat"></div>
        <div class="tooltip-sku" id="tooltipSku"></div>
        <div class="tooltip-thc">
            <div class="tooltip-thc-info">
                <div class="tooltip-label">THC</div>
                <div class="tooltip-value" id="tooltipThc"></div>
            </div>
            <div class="tooltip-thc-info" id="tooltipCbdSection" style="display: none;">
                <div class="tooltip-label">CBD</div>
                <div class="tooltip-value" id="tooltipCbd" style="color: #4CAF50;"></div>
            </div>
        </div>
    </div>

    <!-- Image Viewer Modal -->
    <div class="modal-overlay" id="imageModal" role="dialog" aria-modal="true" aria-labelledby="imageModalTitle">
        <div class="image-modal-content">
            <div class="image-modal-header">
                <h3 id="imageModalTitle"></h3>
                <button class="image-modal-close" id="imageModalCloseBtn" aria-label="Fermer la visualisation">&times;</button>
            </div>
            <div class="image-modal-body">
                <div class="image-modal-file-selector" id="imageModalFileSelector" style="display: none;">
                    <p><strong>Plusieurs fiches trouv√©es. Choisissez laquelle visualiser:</strong></p>
                    <div id="imageModalFileList" class="file-list"></div>
                    <button id="imageModalDisplayBtn" class="modal-btn modal-btn-save">Afficher</button>
                </div>
                <img id="imageModalImg" src="" alt="Image du produit" style="display: none;">
                <iframe id="imageModalPdf" src="" style="display: none;"></iframe>
                <div class="image-modal-loading" id="imageModalLoading" style="display: none;">
                    <p>Recherche des fiches...</p>
                </div>
                <div class="image-modal-error" id="imageModalError" style="display: none;">
                    <p>Aucune fiche trouv√©e pour ce produit</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Modal -->
    <div class="modal-overlay" id="editModal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">Modifier le produit</h3>
                <button class="modal-view-image-btn" id="modalViewImageBtn" aria-label="Visualiser l'image du produit">
                    <span>üëÅ</span> Voir l'image
                </button>
            </div>
            <div class="modal-body">
                <div class="modal-product-name" id="modalProductName" aria-live="polite"></div>

                <div class="modal-field">
                    <label for="modalSectionSelect">Type de souche:</label>
                    <select id="modalSectionSelect" aria-label="S√©lectionner le type de souche du produit">
                        <!-- Options generated dynamically by populateStrainTypeSelect() -->
                    </select>
                </div>

                <div class="modal-field" id="modalFormatField">
                    <label for="modalFormatSelect">Format:</label>
                    <select id="modalFormatSelect" aria-label="S√©lectionner le format du produit">
                        <option value="3,5 g">3,5 g</option>
                        <option value="1 g">1 g</option>
                        <option value="7 g">7 g</option>
                        <option value="28 g">28 g</option>
                        <option value="Pr√©roul√© 3x0,5g">Pr√©roul√© 3x0,5g</option>
                        <option value="Pr√©roul√© 5x0,5g">Pr√©roul√© 5x0,5g</option>
                        <option value="Pr√©roul√© 10x0,35g">Pr√©roul√© 10x0,35g</option>
                        <option value="Pr√©roul√© 1x1g">Pr√©roul√© 1x1g</option>
                    </select>
                </div>

                <div class="modal-field">
                    <label for="modalThcInput">THC %:</label>
                    <input type="number" id="modalThcInput" step="0.1" min="0" max="100" aria-label="Pourcentage THC entre 0 et 100" aria-required="false">
                </div>

                <div class="modal-field">
                    <label for="modalCbdInput">CBD %:</label>
                    <input type="number" id="modalCbdInput" step="0.1" min="0" max="100" aria-label="Pourcentage CBD entre 0 et 100" aria-required="false">
                </div>
            </div>
            <div class="modal-footer">
                <button class="modal-btn modal-btn-cancel" id="modalCancelBtn" aria-label="Annuler les modifications">Annuler</button>
                <button class="modal-btn modal-btn-save" id="modalSaveBtn" aria-label="Sauvegarder les modifications">Sauvegarder</button>
            </div>
        </div>
    </div>

    <!-- Add Product Modal -->
    <div class="modal-overlay" id="addProductModal" role="dialog" aria-modal="true" aria-labelledby="addProductModalTitle">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="addProductModalTitle">Ajouter un produit</h3>
                <button class="modal-close" id="addProductModalCloseBtn" aria-label="Fermer">&times;</button>
            </div>
            <div class="modal-body">
                <div class="modal-field">
                    <label>Mode d'ajout:</label>
                    <div class="radio-group">
                        <label class="radio-label">
                            <input type="radio" name="addProductMode" value="existing" checked>
                            Ajouter un produit existant
                        </label>
                        <label class="radio-label">
                            <input type="radio" name="addProductMode" value="new">
                            Cr√©er un nouveau produit
                        </label>
                    </div>
                </div>
                
                <div id="existingProductFields" class="add-product-section">
                    <div class="modal-field">
                        <label for="addExistingProduct">S√©lectionner un produit: <span style="color: #ff6b6b;">*</span></label>
                        <select id="addExistingProduct" size="10" style="width: 100%; padding: 0.5rem;">
                            <!-- Populated dynamically -->
                        </select>
                    </div>
                    <div class="modal-field">
                        <input type="text" id="searchExistingProduct" placeholder="Rechercher un produit..." style="width: 100%; padding: 0.5rem; margin-bottom: 0.5rem;">
                    </div>
                </div>
                
                <div id="newProductFields" class="add-product-section" style="display: none;">
                    <div class="modal-field">
                        <label for="addProductName">Nom du produit: <span style="color: #ff6b6b;">*</span></label>
                        <input type="text" id="addProductName" placeholder="Ex: Blue Dream" aria-required="true">
                    </div>

                <div class="modal-field">
                    <label for="addProductBrand">Marque:</label>
                    <input type="text" id="addProductBrand" placeholder="Ex: Aurora (optionnel)" aria-required="false">
                </div>

                <div class="modal-field">
                    <label for="addProductSku">SKU: <span style="color: #ff6b6b;">*</span></label>
                    <div style="display: flex; gap: 0.5rem;">
                        <input type="text" id="addProductSku" placeholder="Ex: 12345678" aria-required="true" style="flex: 1;">
                        <button type="button" id="generateSkuBtn" class="modal-btn" style="padding: 0.5rem 1rem; white-space: nowrap;" title="G√©n√©rer un SKU automatiquement">üé≤ Auto</button>
                    </div>
                </div>

                <div class="modal-field">
                    <label for="addProductType">Type de souche: <span style="color: #ff6b6b;">*</span></label>
                    <select id="addProductType" aria-required="true">
                        <!-- Populated dynamically -->
                    </select>
                </div>

                <div class="modal-field">
                    <label for="addProductFormat">Format: <span style="color: #ff6b6b;">*</span></label>
                    <select id="addProductFormat" aria-required="true">
                        <!-- Populated dynamically -->
                    </select>
                </div>

                <div class="modal-field">
                    <label for="addProductThc">THC %: <span style="color: #ff6b6b;">*</span></label>
                    <input type="number" id="addProductThc" step="0.1" min="0" max="100" placeholder="Ex: 24.5" aria-required="true">
                </div>

                <div class="modal-field">
                    <label for="addProductCbd">CBD %:</label>
                    <input type="number" id="addProductCbd" step="0.1" min="0" max="100" placeholder="Ex: 0.5 (optionnel)" aria-required="false">
                </div>
                </div>
                
                <div class="modal-field">
                    <label for="addProductTargetSection">Ajouter √† la section: <span style="color: #ff6b6b;">*</span></label>
                    <select id="addProductTargetSection" aria-required="true">
                        <!-- Populated dynamically -->
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="modal-btn modal-btn-cancel" id="addProductCancelBtn" aria-label="Annuler">Annuler</button>
                <button class="modal-btn modal-btn-save" id="addProductSaveBtn" aria-label="Ajouter le produit">Ajouter</button>
            </div>
        </div>
    </div>

    <!-- Section Manager Modal -->
    <div class="modal-overlay" id="sectionManagerModal" role="dialog" aria-modal="true" aria-labelledby="sectionManagerTitle">
        <div class="modal-content section-manager-modal">
            <div class="modal-header">
                <h3 id="sectionManagerTitle">Gestionnaire de Sections</h3>
                <button class="modal-close" id="sectionManagerCloseBtn" aria-label="Fermer">&times;</button>
            </div>
            
            <div class="modal-body">
                <!-- Wall Navigation Tabs -->
                <div class="manager-section">
                    <h4>Organisation par mur</h4>
                    <div class="wall-tabs">
                        <button class="wall-tab active" data-wall="front">Mur avant</button>
                        <button class="wall-tab" data-wall="side">Mur lat√©ral</button>
                    </div>
                </div>

                <!-- Sections List -->
                <div class="manager-section">
                    <div class="section-header-bar">
                        <h4>Sections</h4>
                        <button class="btn-add-section" id="addSectionBtn">
                            <span>+</span> Ajouter une section
                        </button>
                    </div>
                    
                    <div class="sections-list" id="sectionsList">
                        <!-- Dynamic section items will be inserted here -->
                    </div>
                </div>
            </div>

            <div class="modal-footer">
                <button class="modal-btn modal-btn-cancel" id="sectionManagerCancelBtn">Annuler</button>
                <button class="modal-btn modal-btn-save" id="sectionManagerSaveBtn">Sauvegarder</button>
            </div>
        </div>
    </div>

    <!-- Store ID Edit Modal -->
    <div class="modal-overlay" id="storeIdModal" role="dialog" aria-modal="true" aria-labelledby="storeIdModalTitle">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="storeIdModalTitle">Modifier le num√©ro de succursale</h3>
                <button class="modal-close" id="storeIdModalCloseBtn" aria-label="Fermer">&times;</button>
            </div>
            <div class="modal-body">
                <div class="modal-field">
                    <label for="storeIdInput">Num√©ro de succursale: <span style="color: #ff6b6b;">*</span></label>
                    <input type="text" id="storeIdInput" placeholder="Ex: 77074" maxlength="10" aria-required="true">
                    <p class="help-text">üí° Valeur par d√©faut: 77074</p>
                </div>
            </div>
            <div class="modal-footer">
                <button class="modal-btn modal-btn-cancel" id="storeIdCancelBtn" aria-label="Annuler">Annuler</button>
                <button class="modal-btn modal-btn-save" id="storeIdSaveBtn" aria-label="Sauvegarder">Sauvegarder</button>
            </div>
        </div>
    </div>

    <!-- Section Editor Modal (nested) -->
    <div class="modal-overlay" id="sectionEditorModal" role="dialog" aria-modal="true">
        <div class="modal-content section-editor-modal">
            <div class="modal-header">
                <h3 id="sectionEditorTitle">Nouvelle section</h3>
                <button class="modal-close" id="sectionEditorCloseBtn">&times;</button>
            </div>
            
            <div class="modal-body">
                <!-- Section Name Preview (readonly) -->
                <div class="form-group">
                    <label for="sectionNameDisplay">Nom de la section (automatique)</label>
                    <input type="text" id="sectionNameDisplay" readonly disabled>
                    <p class="help-text">üí° Le nom est g√©n√©r√© automatiquement selon les s√©lections</p>
                </div>

                <!-- Format Selection -->
                <div class="form-group">
                    <label>Formats inclus</label>
                    <div class="checkbox-group" id="formatCheckboxes">
                        <!-- Dynamically generated checkboxes -->
                    </div>
                </div>

                <!-- Strain Type Selection -->
                <div class="form-group">
                    <label>Types de souches</label>
                    <div class="checkbox-group" id="strainTypeCheckboxes">
                        <!-- Dynamically generated checkboxes -->
                    </div>
                </div>

                <!-- Storage Type -->
                <div class="form-group">
                    <label>Type de rangement</label>
                    <div class="radio-group">
                        <label class="radio-label">
                            <input type="radio" name="storageType" value="door" checked>
                            üö™ Portes (affich√©es en haut)
                        </label>
                        <label class="radio-label">
                            <input type="radio" name="storageType" value="drawer">
                            üì¶ Tiroirs (affich√©s en bas)
                        </label>
                    </div>
                    <p class="help-text">
                        üí° Les sections "Portes" s'affichent en haut, les "Tiroirs" en bas
                    </p>
                </div>

                <!-- Storage Count -->
                <div class="form-group">
                    <label for="storageCount">Nombre d'unit√©s de rangement</label>
                    <input type="number" id="storageCount" min="1" max="30" value="12">
                    <p class="help-text">
                        üí° Nombre de portes ou tiroirs selon le type s√©lectionn√©
                    </p>
                </div>

                <!-- Wall Position -->
                <div class="form-group">
                    <label>Position</label>
                    <div class="radio-group">
                        <label class="radio-label">
                            <input type="radio" name="wallPosition" value="front" checked>
                            Mur avant
                        </label>
                        <label class="radio-label">
                            <input type="radio" name="wallPosition" value="side">
                            Mur lat√©ral
                        </label>
                    </div>
                    <p class="help-text">
                        üí° Utilis√© pour organiser l'interface et √©viter le d√©filement
                    </p>
                </div>
            </div>

            <div class="modal-footer">
                <button class="modal-btn modal-btn-cancel" id="sectionEditorCancelBtn">Annuler</button>
                <button class="modal-btn modal-btn-delete" id="sectionEditorDeleteBtn" style="margin-right: auto;">
                    üóëÔ∏è Supprimer
                </button>
                <button class="modal-btn modal-btn-save" id="sectionEditorSaveBtn">Sauvegarder</button>
            </div>
        </div>
    </div>

    <!-- Section Full Editor Modal -->
    <div class="modal-overlay" id="sectionFullEditorModal" role="dialog" aria-modal="true" aria-labelledby="sectionFullEditorTitle">
        <div class="section-full-editor-modal">
            <!-- Header -->
            <div class="section-full-editor-header">
                <h2 id="sectionFullEditorTitle">√âditeur de section</h2>
                <div class="section-full-editor-actions">
                    <button class="modal-btn modal-btn-cancel" id="sectionFullEditorCancelBtn">Annuler</button>
                    <button class="modal-btn modal-btn-save" id="sectionFullEditorSaveBtn">Enregistrer</button>
                    <button class="modal-close" id="sectionFullEditorCloseBtn" aria-label="Fermer">&times;</button>
                </div>
            </div>

            <!-- Main Content Area -->
            <div class="section-full-editor-content">
                <!-- Canvas Area (70%) -->
                <div class="section-full-editor-canvas">
                    <div class="canvas-header">
                        <h3 id="canvasSectionName">Section</h3>
                        <div class="canvas-info">
                            <span id="canvasStorageType">Type</span>
                            <span id="canvasStorageCount">0 unit√©s</span>
                        </div>
                    </div>
                    <div class="canvas-scroll-area">
                        <div id="sectionFullEditorCanvasGrid" class="canvas-grid">
                            <!-- Doors/Drawers rendered here dynamically -->
                        </div>
                    </div>
                    <!-- Footer Controls -->
                    <div class="canvas-footer">
                        <button class="canvas-control-btn" id="addStorageBtn" title="Ajouter une porte/tiroir">
                            <span>‚ûï</span> Ajouter
                        </button>
                        <button class="canvas-control-btn" id="removeStorageBtn" title="Retirer la derni√®re porte/tiroir">
                            <span>‚ûñ</span> Retirer
                        </button>
                        <div class="canvas-stats">
                            <span id="canvasProductCount">0 produits plac√©s</span>
                        </div>
                    </div>
                </div>

                <!-- Sidebar Product Palette (30%) -->
                <div class="section-full-editor-sidebar">
                    <div class="sidebar-header">
                        <h3>Produits disponibles</h3>
                        <span class="sidebar-count" id="sidebarProductCount">0 produits</span>
                    </div>
                    <div class="sidebar-search">
                        <input type="text" id="sidebarSearchInput" placeholder="Rechercher un produit..." />
                    </div>
                    <div class="sidebar-filters">
                        <button class="sidebar-filter-btn active" data-filter="all">Tous</button>
                        <button class="sidebar-filter-btn" data-filter="available">Disponibles</button>
                        <button class="sidebar-filter-btn" data-filter="placed">Plac√©s</button>
                    </div>
                    <div id="sectionFullEditorPalette" class="sidebar-palette">
                        <!-- Product cards rendered here dynamically -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="config.js"></script>
    <script src="products-data.js"></script>
    <script src="files-index-data.js"></script>
    <script src="app.js"></script>
</body>
</html>
