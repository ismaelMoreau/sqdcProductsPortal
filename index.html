<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SQDC - Portail des Produits</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <header>
        <div class="header-content">
            <div class="logo-section">
                <div class="sqdc-logo">SQDC</div>
                <h1>Portail des Produits</h1>
            </div>
            <div class="store-info">
                <a href="print-lists.html" class="print-lists-link" title="G√©rer les listes d'impression">
                    üñ®Ô∏è Listes d'impression
                </a>
                <button class="section-config-btn" id="sectionConfigBtn" title="Configurer les sections">
                    <span class="config-icon">‚öôÔ∏è</span> Configurer les sections
                </button>
                <span class="store-label">Succursale: <span id="storeIdDisplay">77074</span></span>
            </div>
        </div>
    </header>

    <div class="controls">
        <div class="filter-section">
            <h3>Type de Cannabis</h3>
            <div class="filter-buttons" role="group" aria-label="Filtres de type de cannabis">
                <button class="filter-btn active" data-type="all" aria-pressed="true" aria-label="Afficher tous les types">
                    <span>Tous</span>
                </button>
                <button class="filter-btn active" data-type="Indica" aria-pressed="true" aria-label="Filtrer par type Indica">
                    <span class="icon indica-icon">‚óè</span>
                    <span>Indica</span>
                </button>
                <button class="filter-btn active" data-type="Sativa" aria-pressed="true" aria-label="Filtrer par type Sativa">
                    <span class="icon sativa-icon">‚óè</span>
                    <span>Sativa</span>
                </button>
                <button class="filter-btn active" data-type="Hybride" aria-pressed="true" aria-label="Filtrer par type Hybride">
                    <span class="icon hybride-icon">‚óè</span>
                    <span>Hybride</span>
                </button>
            </div>
        </div>

        <div class="search-section">
            <input type="text" id="searchInput" placeholder="Rechercher par nom ou marque..." aria-label="Rechercher des produits par nom ou marque">
        </div>
        
        <button class="add-product-btn" id="addProductBtn" title="Ajouter un nouveau produit">
            <span class="add-icon">‚ûï</span> Ajouter un produit
        </button>
    </div>

    <div class="wall-navigation" id="wallNavigation">
        <button class="wall-nav-btn active" data-wall="front">
            üè† Mur avant
        </button>
        <button class="wall-nav-btn" data-wall="side">
            üî≤ Mur lat√©ral
        </button>
    </div>

        <main>
        <!-- Dynamic sections will be generated here by regenerateSectionsHTML() -->
    </main>

    <!-- Tooltip for product details -->
    <div class="product-tooltip" id="productTooltip">
        <div class="tooltip-name" id="tooltipName"></div>
        <div class="tooltip-brand" id="tooltipBrand"></div>
        <div class="tooltip-format" id="tooltipFormat"></div>
        <div class="tooltip-sku" id="tooltipSku"></div>
        <div class="tooltip-thc">
            <div class="tooltip-thc-info">
                <div class="tooltip-label">THC</div>
                <div class="tooltip-value" id="tooltipThc"></div>
            </div>
            <div class="tooltip-thc-info" id="tooltipCbdSection" style="display: none;">
                <div class="tooltip-label">CBD</div>
                <div class="tooltip-value" id="tooltipCbd" style="color: #4CAF50;"></div>
            </div>
        </div>
    </div>

    <!-- Image Viewer Modal -->
    <div class="modal-overlay" id="imageModal" role="dialog" aria-modal="true" aria-labelledby="imageModalTitle">
        <div class="image-modal-content">
            <div class="image-modal-header">
                <h3 id="imageModalTitle"></h3>
                <button class="image-modal-close" id="imageModalCloseBtn" aria-label="Fermer la visualisation">&times;</button>
            </div>
            <div class="image-modal-body">
                <div class="image-modal-file-selector" id="imageModalFileSelector" style="display: none;">
                    <p><strong>Plusieurs fiches trouv√©es. Choisissez laquelle visualiser:</strong></p>
                    <div id="imageModalFileList" class="file-list"></div>
                    <button id="imageModalDisplayBtn" class="modal-btn modal-btn-save">Afficher</button>
                </div>
                <img id="imageModalImg" src="" alt="Image du produit" style="display: none;">
                <iframe id="imageModalPdf" src="" style="display: none;"></iframe>
                <div class="image-modal-loading" id="imageModalLoading" style="display: none;">
                    <p>Recherche des fiches...</p>
                </div>
                <div class="image-modal-error" id="imageModalError" style="display: none;">
                    <p>Aucune fiche trouv√©e pour ce produit</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Modal -->
    <div class="modal-overlay" id="editModal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">Modifier le produit</h3>
                <button class="modal-view-image-btn" id="modalViewImageBtn" aria-label="Visualiser l'image du produit">
                    <span>üëÅ</span> Voir l'image
                </button>
            </div>
            <div class="modal-body">
                <div class="modal-product-name" id="modalProductName" aria-live="polite"></div>

                <div class="modal-field">
                    <label for="modalSectionSelect">Section:</label>
                    <select id="modalSectionSelect" aria-label="S√©lectionner la section du produit">
                        <option value="Indica">Indica</option>
                        <option value="Sativa">Sativa</option>
                        <option value="Hybride">Hybride</option>
                        <option value="28g">28g</option>
                    </select>
                </div>

                <div class="modal-field" id="modalFormatField">
                    <label for="modalFormatSelect">Format:</label>
                    <select id="modalFormatSelect" aria-label="S√©lectionner le format du produit">
                        <option value="3,5 g">3,5 g</option>
                        <option value="1 g">1 g</option>
                        <option value="7 g">7 g</option>
                        <option value="28 g">28 g</option>
                        <option value="Pr√©roul√© 3x0,5g">Pr√©roul√© 3x0,5g</option>
                        <option value="Pr√©roul√© 5x0,5g">Pr√©roul√© 5x0,5g</option>
                        <option value="Pr√©roul√© 10x0,35g">Pr√©roul√© 10x0,35g</option>
                        <option value="Pr√©roul√© 1x1g">Pr√©roul√© 1x1g</option>
                    </select>
                </div>

                <div class="modal-field">
                    <label for="modalThcInput">THC %:</label>
                    <input type="number" id="modalThcInput" step="0.1" min="0" max="100" aria-label="Pourcentage THC entre 0 et 100" aria-required="false">
                </div>

                <div class="modal-field">
                    <label for="modalCbdInput">CBD %:</label>
                    <input type="number" id="modalCbdInput" step="0.1" min="0" max="100" aria-label="Pourcentage CBD entre 0 et 100" aria-required="false">
                </div>
            </div>
            <div class="modal-footer">
                <button class="modal-btn modal-btn-cancel" id="modalCancelBtn" aria-label="Annuler les modifications">Annuler</button>
                <button class="modal-btn modal-btn-save" id="modalSaveBtn" aria-label="Sauvegarder les modifications">Sauvegarder</button>
            </div>
        </div>
    </div>

    <!-- Add Product Modal -->
    <div class="modal-overlay" id="addProductModal" role="dialog" aria-modal="true" aria-labelledby="addProductModalTitle">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="addProductModalTitle">Ajouter un nouveau produit</h3>
                <button class="modal-close" id="addProductModalCloseBtn" aria-label="Fermer">&times;</button>
            </div>
            <div class="modal-body">
                <div class="modal-field">
                    <label for="addProductName">Nom du produit: <span style="color: #ff6b6b;">*</span></label>
                    <input type="text" id="addProductName" placeholder="Ex: Blue Dream" aria-required="true">
                </div>

                <div class="modal-field">
                    <label for="addProductBrand">Marque: <span style="color: #ff6b6b;">*</span></label>
                    <input type="text" id="addProductBrand" placeholder="Ex: Aurora" aria-required="true">
                </div>

                <div class="modal-field">
                    <label for="addProductSku">SKU: <span style="color: #ff6b6b;">*</span></label>
                    <input type="text" id="addProductSku" placeholder="Ex: 12345678" aria-required="true">
                </div>

                <div class="modal-field">
                    <label for="addProductSection">Section: <span style="color: #ff6b6b;">*</span></label>
                    <select id="addProductSection" aria-required="true">
                        <!-- Populated dynamically -->
                    </select>
                </div>

                <div class="modal-field">
                    <label for="addProductFormat">Format: <span style="color: #ff6b6b;">*</span></label>
                    <select id="addProductFormat" aria-required="true">
                        <!-- Populated dynamically -->
                    </select>
                </div>

                <div class="modal-field">
                    <label for="addProductThc">THC %: <span style="color: #ff6b6b;">*</span></label>
                    <input type="number" id="addProductThc" step="0.1" min="0" max="100" placeholder="Ex: 24.5" aria-required="true">
                </div>

                <div class="modal-field">
                    <label for="addProductCbd">CBD %:</label>
                    <input type="number" id="addProductCbd" step="0.1" min="0" max="100" placeholder="Ex: 0.5 (optionnel)" aria-required="false">
                </div>
            </div>
            <div class="modal-footer">
                <button class="modal-btn modal-btn-cancel" id="addProductCancelBtn" aria-label="Annuler">Annuler</button>
                <button class="modal-btn modal-btn-save" id="addProductSaveBtn" aria-label="Ajouter le produit">Ajouter</button>
            </div>
        </div>
    </div>

    <!-- Section Manager Modal -->
    <div class="modal-overlay" id="sectionManagerModal" role="dialog" aria-modal="true" aria-labelledby="sectionManagerTitle">
        <div class="modal-content section-manager-modal">
            <div class="modal-header">
                <h3 id="sectionManagerTitle">Gestionnaire de Sections</h3>
                <button class="modal-close" id="sectionManagerCloseBtn" aria-label="Fermer">&times;</button>
            </div>
            
            <div class="modal-body">
                <!-- Wall Navigation Tabs -->
                <div class="manager-section">
                    <h4>Organisation par mur</h4>
                    <div class="wall-tabs">
                        <button class="wall-tab active" data-wall="front">Mur avant</button>
                        <button class="wall-tab" data-wall="side">Mur lat√©ral</button>
                    </div>
                </div>

                <!-- Sections List -->
                <div class="manager-section">
                    <div class="section-header-bar">
                        <h4>Sections</h4>
                        <button class="btn-add-section" id="addSectionBtn">
                            <span>+</span> Ajouter une section
                        </button>
                    </div>
                    
                    <div class="sections-list" id="sectionsList">
                        <!-- Dynamic section items will be inserted here -->
                    </div>
                </div>
            </div>

            <div class="modal-footer">
                <button class="modal-btn modal-btn-cancel" id="sectionManagerCancelBtn">Annuler</button>
                <button class="modal-btn modal-btn-save" id="sectionManagerSaveBtn">Sauvegarder</button>
            </div>
        </div>
    </div>

    <!-- Section Editor Modal (nested) -->
    <div class="modal-overlay" id="sectionEditorModal" role="dialog" aria-modal="true">
        <div class="modal-content section-editor-modal">
            <div class="modal-header">
                <h3 id="sectionEditorTitle">√âditer la section</h3>
                <button class="modal-close" id="sectionEditorCloseBtn">&times;</button>
            </div>
            
            <div class="modal-body">
                <!-- Section Name Preview (readonly) -->
                <div class="form-group">
                    <label for="sectionNameDisplay">Nom de la section (automatique)</label>
                    <input type="text" id="sectionNameDisplay" readonly disabled>
                    <p class="help-text">üí° Le nom est g√©n√©r√© automatiquement selon les s√©lections</p>
                </div>

                <!-- Format Selection -->
                <div class="form-group">
                    <label>Formats inclus</label>
                    <div class="checkbox-group" id="formatCheckboxes">
                        <!-- Dynamically generated checkboxes -->
                    </div>
                </div>

                <!-- Strain Type Selection -->
                <div class="form-group">
                    <label>Types de souches</label>
                    <div class="checkbox-group" id="strainTypeCheckboxes">
                        <!-- Dynamically generated checkboxes -->
                    </div>
                </div>

                <!-- Storage Type -->
                <div class="form-group">
                    <label>Type de rangement</label>
                    <div class="radio-group">
                        <label class="radio-label">
                            <input type="radio" name="storageType" value="door" checked>
                            üö™ Portes (affich√©es en haut)
                        </label>
                        <label class="radio-label">
                            <input type="radio" name="storageType" value="drawer">
                            üì¶ Tiroirs (affich√©s en bas)
                        </label>
                    </div>
                    <p class="help-text">
                        üí° Les sections "Portes" s'affichent en haut, les "Tiroirs" en bas
                    </p>
                </div>

                <!-- Storage Count -->
                <div class="form-group">
                    <label for="storageCount">Nombre d'unit√©s de rangement</label>
                    <input type="number" id="storageCount" min="1" max="30" value="12">
                    <p class="help-text">
                        üí° Nombre de portes ou tiroirs selon le type s√©lectionn√©
                    </p>
                </div>

                <!-- Wall Position -->
                <div class="form-group">
                    <label>Position</label>
                    <div class="radio-group">
                        <label class="radio-label">
                            <input type="radio" name="wallPosition" value="front" checked>
                            Mur avant
                        </label>
                        <label class="radio-label">
                            <input type="radio" name="wallPosition" value="side">
                            Mur lat√©ral
                        </label>
                    </div>
                    <p class="help-text">
                        üí° Utilis√© pour organiser l'interface et √©viter le d√©filement
                    </p>
                </div>
            </div>

            <div class="modal-footer">
                <button class="modal-btn modal-btn-cancel" id="sectionEditorCancelBtn">Annuler</button>
                <button class="modal-btn modal-btn-delete" id="sectionEditorDeleteBtn" style="margin-right: auto;">
                    üóëÔ∏è Supprimer
                </button>
                <button class="modal-btn modal-btn-save" id="sectionEditorSaveBtn">Sauvegarder</button>
            </div>
        </div>
    </div>

    <script src="config.js"></script>
    <script src="products-data.js"></script>
    <script src="files-index-data.js"></script>
    <script src="app.js"></script>
</body>
</html>
